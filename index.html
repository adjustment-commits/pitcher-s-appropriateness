<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æŠ•æ‰‹é©æ€§åˆ¤å®šï¼ˆRunï¼‰</title>
<link rel="apple-touch-icon" sizes="192x192" href="main/icons-192-v2.png">
<link rel="apple-touch-icon" sizes="512x512" href="main/icons-512-v2.png">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<meta name="theme-color" content="#222222">
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
  }
</script>
  <style>
    body { font-family: system-ui, sans-serif; margin: 10px; background: #f5f5f5; }
    h1 { text-align: center; font-size: 20px; margin-top: 80px;}
    .input-box { background: #fff; padding: 12px; border-radius: 8px; margin-bottom: 15px; }
    label { display: block; margin-top: 8px; font-size: 14px; }
    input { padding: 5px; margin-top: 3px; width: 100%; }
    button { margin-top: 12px; padding: 8px; font-size: 13px; }
    #result, #history { margin-top: 15px; padding: 10px; background: #fff; border-radius: 8px; }
    canvas { width: 100% !important; max-width: 100%; height: auto !important; }
    .delBtn { margin-left: 10px; font-size: 12px; padding: 2px 6px; }
  </style>
</head>
<body>
   <!-- â–¼ VOâ‚‚maxé–¢é€£ãƒªãƒ³ã‚¯ -->
  <div style="position: absolute; top: 15px; right: 15px; text-align: right;">
    <p style="color:#555; font-size:13px; margin:0 0 4px;">Running fitnessã‹ã‚‰é©æ­£å½¹å‰²ã‚’å‚è€ƒ</p>
    <a href="https://adjustment-commits.github.io/pitcher-running-fitness-2025-10/"
       style="display:inline-block; margin:2px; padding:6px 10px; border-radius:6px; background:#2563eb; color:#fff; text-decoration:none; font-size:12px;">
       ğŸ“˜ ç°¡æ˜“ç‰ˆ
    </a>
    <a href="https://adjustment-commits.github.io/pitcher-vo2max/"
       style="display:inline-block; margin:2px; padding:6px 10px; border-radius:6px; background:#0f172a; color:#f1f5f9; text-decoration:none; font-size:12px;">
       ğŸ“— æœ¬æ ¼ç‰ˆ
    </a>
  </div>
  
  <h1>æŠ•æ‰‹é©æ€§åˆ¤å®š(Run)</h1>

  <div class="input-box">
    <label>é¸æ‰‹å: <input type="text" id="name" placeholder="ä¾‹: å±±ç”°"></label>
    <label>æ—¥ä»˜: <input type="date" id="date"></label>
    <label>ã‚¯ãƒ¼ãƒ‘ãƒ¼èµ°è·é›¢ (m): <input type="number" id="cooper" placeholder="ä¾‹: 2700"></label>
    <label>Yo-Yo IRè·é›¢ (m): <input type="number" id="yoyo" placeholder="ä¾‹: 1600"></label>
    <label>10mã‚¹ãƒ—ãƒªãƒ³ãƒˆ (ç§’): <input type="number" step="0.01" id="s10" placeholder="ä¾‹: 1.55"></label>
    <label>30mã‚¹ãƒ—ãƒªãƒ³ãƒˆ (ç§’): <input type="number" step="0.01" id="s30" placeholder="ä¾‹: 4.05"></label>
    <label>50mã‚¹ãƒ—ãƒªãƒ³ãƒˆ (ç§’): <input type="number" step="0.01" id="s50" placeholder="ä¾‹: 6.40"></label>
    <button onclick="check()">åˆ¤å®šã—ã¦å±¥æ­´ã«è¿½åŠ </button>
  </div>
   
  <!-- â–² VOâ‚‚maxé–¢é€£ãƒªãƒ³ã‚¯ã“ã“ã¾ã§ -->

  <div id="result"></div>
  <div id="history">
    <h2>å±¥æ­´</h2>
    <ul id="historyList"></ul>
    <button onclick="clearHistory()">å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤</button>
  </div>

  <canvas id="map"></canvas>

  <script>
    // VO2maxæ›ç®—å¼
    function cooperToVO2max(dist) { return (dist - 504.9) / 44.73; }
    function yoyoToVO2max(dist) { return dist * 0.0084 + 36.4; }

    // è‰²åˆ†ã‘ãƒ«ãƒ¼ãƒ«
    function getRoleColor(vo2, sprintScore) {
      if (vo2 >= 51 && sprintScore >= 3) return {role:"â— ã‚¨ãƒ¼ã‚¹æ ¼", color:"gold"};
      if (vo2 >= 51 && sprintScore < 3) return {role:"ãƒ­ãƒ³ã‚°å…ˆç™º", color:"blue"};
      if (vo2 >= 47 && vo2 < 51 && sprintScore >= 2) return {role:"ä¸­ç¶™ã", color:"green"};
      if (vo2 < 47 && sprintScore >= 2) return {role:"æŠ‘ãˆï¼ã‚·ãƒ§ãƒ¼ãƒˆ", color:"red"};
      return {role:"åŸºç¤ä¸è¶³", color:"gray"};
    }

    // ã‚°ãƒ©ãƒ•åˆæœŸåŒ–
    const ctx = document.getElementById('map').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'scatter',
      data: { datasets: [] },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: function(context) {
                const p = context.raw;
                return `${p.date} ${p.name} â†’ ${p.role} (VOâ‚‚:${p.x.toFixed(1)}, Sprint:${p.y})`;
              }
            }
          }
        },
        scales: {
          x: { title: { display: true, text: 'VOâ‚‚max (ml/kg/min)' }, min: 35, max: 60 },
          y: { title: { display: true, text: 'ã‚¹ãƒ—ãƒªãƒ³ãƒˆã‚¹ã‚³ã‚¢ (0ã€œ4)' }, min: 0, max: 4 }
        }
      }
    });

    // å±¥æ­´ãƒ­ãƒ¼ãƒ‰
    function loadHistory() {
      const list = document.getElementById("historyList");
      list.innerHTML = "";
      const data = JSON.parse(localStorage.getItem("history") || "[]");

      // ã‚°ãƒ©ãƒ•ãƒªã‚»ãƒƒãƒˆ
      chart.data.datasets = [];

      data.forEach((item, index) => {
        const li = document.createElement("li");
        li.textContent = `${item.date} ${item.name} â†’ ${item.role} (VOâ‚‚:${item.vo2.toFixed(1)}, Sprint:${item.sprint})`;

        // å€‹åˆ¥å‰Šé™¤ãƒœã‚¿ãƒ³
        const delBtn = document.createElement("button");
        delBtn.textContent = "å‰Šé™¤";
        delBtn.className = "delBtn";
        delBtn.onclick = () => {
          data.splice(index,1); 
          localStorage.setItem("history", JSON.stringify(data));
          loadHistory();
        };
        li.appendChild(delBtn);
        list.appendChild(li);

        // ã‚°ãƒ©ãƒ•ã«æç”»
        chart.data.datasets.push({
          label: item.name,
          data: [{x: item.vo2, y: item.sprint, name: item.name, date: item.date, role: item.role}],
          backgroundColor: item.color,
          pointRadius: 6
        });
      });
      chart.update();
    }

    // å±¥æ­´å…¨å‰Šé™¤
    function clearHistory() {
      if (confirm("å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
        localStorage.removeItem("history");
        loadHistory();
      }
    }

    // åˆ¤å®šå‡¦ç†
    function check() {
      const name = document.getElementById("name").value || "ç„¡å";
      const date = document.getElementById("date").value || new Date().toISOString().slice(0,10);
      const cooper = parseFloat(document.getElementById("cooper").value);
      const yoyo = parseFloat(document.getElementById("yoyo").value);
      const s10 = parseFloat(document.getElementById("s10").value);
      const s30 = parseFloat(document.getElementById("s30").value);
      const s50 = parseFloat(document.getElementById("s50").value);

      if (isNaN(cooper) && isNaN(yoyo)) {
        alert("ã‚¯ãƒ¼ãƒ‘ãƒ¼èµ°ã¾ãŸã¯Yo-Yoã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }

      let vo2list = [];
      if (!isNaN(cooper)) vo2list.push(cooperToVO2max(cooper));
      if (!isNaN(yoyo)) vo2list.push(yoyoToVO2max(yoyo));
      const vo2avg = vo2list.reduce((a,b)=>a+b,0) / vo2list.length;

      // ã‚¹ãƒ—ãƒªãƒ³ãƒˆã‚¹ã‚³ã‚¢
      let sprintScore = 0;
      if (!isNaN(s10) && s10 <= 1.55) sprintScore += 2;
      if (!isNaN(s30) && s30 <= 4.0) sprintScore += 1;
      if (!isNaN(s50) && s50 <= 6.4) sprintScore += 1;

      const {role, color} = getRoleColor(vo2avg, sprintScore);

      // çµæœè¡¨ç¤º
      document.getElementById("result").innerHTML = `
        <h2>åˆ¤å®šçµæœ</h2>
        <p>${date} ${name}</p>
        <p>VOâ‚‚maxï¼š${vo2avg.toFixed(1)} ml/kg/min</p>
        <p>ã‚¹ãƒ—ãƒªãƒ³ãƒˆã‚¹ã‚³ã‚¢ï¼š${sprintScore}/4</p>
        <p><strong>${role}</strong></p>
      `;

      // ä¿å­˜
      const history = JSON.parse(localStorage.getItem("history") || "[]");
      history.push({date: date, name: name, vo2: vo2avg, sprint: sprintScore, role: role, color: color});
      localStorage.setItem("history", JSON.stringify(history));
      loadHistory();
    }

    // åˆæœŸãƒ­ãƒ¼ãƒ‰
    loadHistory();
  </script>
    <canvas id="map"></canvas>

    <div style="text-align:center; margin-top:20px; color:#888; font-size:12px;">
    Â©ï¸ 2025 adjustment-lab
  </div>
  </body>
</html>
